<form id="key-value-form" method="POST">
    <label for="num_pairs">Enter number of key-value pairs:</label>
    <input type="number" name="num_pairs" id="num_pairs" required><br><br>

    <div id="key-value-pairs"></div>

    <input type="submit" value="Generate QR Code">
</form>

<script>
    document.getElementById('num_pairs').addEventListener('change', function() {
        let numPairs = parseInt(this.value);
        let keyValuePairDiv = document.getElementById('key-value-pairs');
        keyValuePairDiv.innerHTML = '';

        for (let i = 1; i <= numPairs; i++) {
            let keyLabel = document.createElement('label');
            keyLabel.textContent = `Key ${i}: `;
            let keyInput = document.createElement('input');
            keyInput.setAttribute('type', 'text');
            keyInput.setAttribute('name', `key_${i}`);
            keyValuePairDiv.appendChild(keyLabel);
            keyValuePairDiv.appendChild(keyInput);
            
            let valueLabel = document.createElement('label');
            valueLabel.textContent = `Value ${i}: `;
            let valueInput = document.createElement('input');
            valueInput.setAttribute('type', 'text');
            valueInput.setAttribute('name', `value_${i}`);
            keyValuePairDiv.appendChild(valueLabel);
            keyValuePairDiv.appendChild(valueInput);

            keyValuePairDiv.appendChild(document.createElement('br'));
        }
    });

    document.getElementById('key-value-form').addEventListener('submit', function(event) {
        event.preventDefault();

        // Serialize form data into JSON object
        let formData = {};
        const formElements = this.elements;

        for (let i = 0; i < formElements.length; i++) {
            const element = formElements[i];
            if (element.name) {
                formData[element.name] = element.value;
            }
        }

        fetch('/generate_qr', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        }).then(response => {
            // Handle response as needed
            window.location.href = '/result'; // Redirect to result page after submission
        }).catch(error => {
            console.error('Error:', error);
        });
    });
</script>
